# EC2 Auto Scaling - ウォームプールの混合インスタンスポリシーサポート

**リリース日**: 2025 年 11 月 10 日  
**サービス**: Amazon EC2 Auto Scaling  
**機能**: ウォームプールの混合インスタンスポリシーサポート


## 概要

EC2 Auto Scaling グループは、混合インスタンスポリシーで構成された Auto Scaling グループに対してウォームプールをサポートするようになりました。ウォームプールは、事前に初期化された EC2 インスタンスのプールを作成し、アプリケーショントラフィックに迅速に対応できるようにすることで、アプリケーションの弾力性を向上させます。

この機能は、ディスクへの大量データ書き込みや複雑なカスタムスクリプトの実行など、初期化プロセスに時間がかかるアプリケーションに特に有効です。

**アップデート前の課題**

- ウォームプールは単一のインスタンスタイプのみをサポートしており、混合インスタンスポリシーとの併用ができなかった
- 複数のインスタンスタイプを使用する Auto Scaling グループでは、ウォームプールによる迅速なスケールアウトの恩恵を受けられなかった
- 可用性とコスト最適化のために混合インスタンスポリシーを使用すると、初期化時間の短縮ができなかった

**アップデート後の改善**

- 混合インスタンスポリシーで構成された Auto Scaling グループでもウォームプールが利用可能になった
- 複数のインスタンスタイプを使用しながら、事前初期化による迅速なスケールアウトを実現できるようになった
- 可用性、コスト最適化、起動時間短縮を同時に達成できるようになった


## サービスアップデートの詳細

### 主要機能

1. **混合インスタンスポリシーとの統合**
   - 複数のインスタンスタイプでウォームプールを利用可能
   - 手動インスタンスタイプリストまたは属性ベースのインスタンスタイプ選択に対応
   - 可用性を高めながら迅速なスケールアウトを実現

2. **事前初期化インスタンス**
   - アプリケーションの初期化を事前に完了
   - スケールアウト時の待機時間を大幅に短縮
   - 複雑な起動プロセスを持つアプリケーションに最適

3. **インスタンスタイプの柔軟性**
   - 複数のオンデマンドインスタンスタイプをサポート
   - 属性ベースのインスタンスタイプ選択 (ABS) に対応
   - 可用性とコスト最適化の両立


## 技術仕様

### ウォームプールの設定オプション

| 項目 | 詳細 |
|------|------|
| プールサイズ | 最小/最大インスタンス数を指定可能 |
| インスタンス状態 | Stopped、Running、Hibernated |
| 再利用ポリシー | 終了または再利用を選択可能 |
| ライフサイクルフック | ウォームプール専用フックをサポート |

### 混合インスタンスポリシーの設定

```json
{
  "MixedInstancesPolicy": {
    "LaunchTemplate": {
      "LaunchTemplateSpecification": {
        "LaunchTemplateId": "lt-xxxxxxxxxxxxxxxxx",
        "Version": "$Latest"
      },
      "Overrides": [
        {"InstanceType": "m5.large"},
        {"InstanceType": "m5a.large"},
        {"InstanceType": "m6i.large"}
      ]
    },
    "InstancesDistribution": {
      "OnDemandBaseCapacity": 1,
      "OnDemandPercentageAboveBaseCapacity": 50,
      "SpotAllocationStrategy": "capacity-optimized"
    }
  }
}
```

この設定例は、混合インスタンスポリシーを定義しています。`Overrides` で複数のインスタンスタイプ (m5.large、m5a.large、m6i.large) を指定し、`InstancesDistribution` でオンデマンドとスポットインスタンスの配分を設定しています。ベース容量として 1 台のオンデマンドインスタンスを確保し、それ以上は 50% をオンデマンド、残りをスポットインスタンスで構成します。


## 設定方法

### 前提条件

1. EC2 Auto Scaling グループが設定済み
2. 混合インスタンスポリシーが構成済み
3. 適切な IAM 権限

### 手順

#### ステップ 1: ウォームプールの作成

```bash
aws autoscaling put-warm-pool \
  --auto-scaling-group-name my-asg \
  --pool-state Stopped \
  --min-size 2 \
  --max-group-prepared-capacity 10
```

#### ステップ 2: ウォームプールの確認

```bash
aws autoscaling describe-warm-pool \
  --auto-scaling-group-name my-asg
```

このコマンドは、指定した Auto Scaling グループのウォームプール設定と現在のインスタンス状態を確認します。プールサイズ、インスタンス状態、ライフサイクルフックの設定などの詳細が表示されます。


## メリット

### ビジネス面

- **応答性の向上**: トラフィックスパイクへの迅速な対応
- **可用性の向上**: 複数インスタンスタイプによる耐障害性
- **コスト最適化**: スポットインスタンスとの組み合わせ

### 技術面

- **起動時間の短縮**: 事前初期化による待機時間削減
- **柔軟なスケーリング**: 最大容量まで迅速にスケールアウト
- **インスタンスタイプの多様性**: 可用性ゾーン間での分散


## デメリット・制約事項

### 制限事項

- ウォームプールインスタンスには追加コストが発生
- Stopped 状態のインスタンスでも EBS ボリューム料金が発生

### 考慮すべき点

- ウォームプールサイズの適切な設定
- インスタンス状態 (Stopped/Running) の選択


## ユースケース

### ユースケース 1: 大規模データ初期化

**シナリオ**: アプリケーション起動時に大量のデータをディスクに書き込む必要がある

**効果**: ウォームプールで事前にデータを準備し、スケールアウト時間を短縮

### ユースケース 2: 複雑な起動スクリプト

**シナリオ**: カスタムスクリプトの実行に数分かかる

**効果**: 事前初期化により、トラフィック増加時に即座に対応可能

### ユースケース 3: 高可用性要件

**シナリオ**: 複数のインスタンスタイプを使用して可用性を確保したい

**効果**: 混合インスタンスポリシーとウォームプールの組み合わせで実現


## 料金

ウォームプール内のインスタンスには、その状態に応じた料金が発生します。

| インスタンス状態 | 料金 |
|----------------|------|
| Running | 通常の EC2 料金 |
| Stopped | EBS ボリューム料金のみ |
| Hibernated | EBS ボリューム料金のみ |


## 利用可能リージョン

EC2 Auto Scaling が利用可能なすべての AWS リージョンで利用可能です。


## 関連サービス・機能

- **Amazon EC2 Auto Scaling**: 自動スケーリングサービス
- **Amazon EC2**: 仮想サーバーサービス
- **AWS Launch Templates**: インスタンス起動テンプレート


## 参考リンク

- [公式発表](https://aws.amazon.com/about-aws/whats-new/2025/11/ec2-auto-scaling-warm-pool-mixed-instances-policies/)
- [EC2 Auto Scaling ウォームプール](https://docs.aws.amazon.com/autoscaling/ec2/userguide/ec2-auto-scaling-warm-pools.html)


## まとめ

EC2 Auto Scaling のウォームプールと混合インスタンスポリシーの統合により、複数のインスタンスタイプを使用しながら迅速なスケールアウトが可能になりました。初期化に時間がかかるアプリケーションや高可用性が求められるワークロードに最適なアップデートです。
