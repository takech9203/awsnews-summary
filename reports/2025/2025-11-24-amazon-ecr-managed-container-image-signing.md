# Amazon ECR - マネージドコンテナイメージ署名

**リリース日**: 2025 年 11 月 24 日  
**サービス**: Amazon ECR  
**機能**: マネージドコンテナイメージ署名


## 概要

Amazon ECR は、マネージドコンテナイメージ署名を発表しました。この機能により、コンテナイメージの整合性と出所を検証するための署名を、AWS マネージドな方法で簡単に実装できます。

サプライチェーンセキュリティの強化とコンプライアンス要件への対応に最適です。

**アップデート前の課題**

- 以前はコンテナイメージの署名を実装するために、Sigstore/Cosign などの外部ツールを自前で設定・管理する必要があった
- 以前は署名キーの管理やワークフローの構築に専門知識と運用負担が必要だった
- 以前は CI/CD パイプラインでのイメージ署名と検証の自動化が複雑だった

**アップデート後の改善**

- 今回のアップデートにより、AWS マネージドな方法でコンテナイメージの署名を簡単に実装できるようになった
- 今回のアップデートにより、AWS KMS との統合で署名キーの安全な管理が自動化されるようになった
- 今回のアップデートにより、プッシュ時の自動署名とプル時の署名検証でサプライチェーンセキュリティが強化されるようになった


## サービスアップデートの詳細

### 主要機能

1. **マネージド署名**
   - AWS による署名インフラの管理
   - 自動署名ワークフロー
   - 署名キーの安全な管理

2. **署名検証**
   - プッシュ時の自動署名
   - プル時の署名検証
   - ポリシーベースの検証

3. **統合**
   - AWS KMS との統合
   - CI/CD パイプラインとの統合
   - Kubernetes との統合


## 技術仕様

### 署名の仕様

| 項目 | 詳細 |
|------|------|
| 署名形式 | Sigstore/Cosign 互換 |
| キー管理 | AWS KMS |
| 検証 | 自動/ポリシーベース |
| 監査 | CloudTrail 統合 |

### 設定例

```json
{
  "repositoryName": "my-repo",
  "imageSigningConfiguration": {
    "signingEnabled": true,
    "kmsKeyId": "arn:aws:kms:us-east-1:123456789012:key/xxxxx",
    "signatureVerificationPolicy": "REQUIRED"
  }
}
```

この設定例は、ECR リポジトリのイメージ署名設定を定義しています。`signingEnabled` で署名を有効化し、`kmsKeyId` で署名に使用する KMS キーを指定します。`signatureVerificationPolicy` を `REQUIRED` に設定することで、署名されていないイメージのプルを拒否できます。


## 設定方法

### 前提条件

1. ECR リポジトリが作成済み
2. KMS キーが作成済み
3. 適切な IAM 権限

### 手順

#### ステップ 1: 署名の有効化

```bash
aws ecr put-image-signing-configuration \
  --repository-name my-repo \
  --signing-configuration signingEnabled=true,kmsKeyId=arn:aws:kms:us-east-1:123456789012:key/xxxxx
```

#### ステップ 2: イメージのプッシュ

```bash
docker push 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-repo:latest
# 自動的に署名が付与される
```

#### ステップ 3: 署名の検証

```bash
aws ecr describe-image-signing-status \
  --repository-name my-repo \
  --image-id imageTag=latest
```

このコマンドは、指定したイメージの署名ステータスを確認します。署名が有効かどうか、署名に使用されたキー、署名日時などの情報を取得できます。


## メリット

### ビジネス面

- **セキュリティ強化**: サプライチェーン攻撃の防止
- **コンプライアンス**: 規制要件への対応
- **信頼性**: イメージの出所と整合性の保証

### 技術面

- **自動化**: 署名ワークフローの自動化
- **統合**: 既存ツールとの互換性
- **監査**: 完全な監査証跡


## デメリット・制約事項

### 制限事項

- 署名にはわずかなオーバーヘッドが発生
- KMS キーの管理が必要

### 考慮すべき点

- 既存の CI/CD パイプラインへの統合
- 署名ポリシーの設計


## ユースケース

### ユースケース 1: セキュアな CI/CD パイプライン

**シナリオ**: ビルドしたイメージの整合性を保証したい

**効果**: 自動署名により、改ざんされていないイメージのみをデプロイ

### ユースケース 2: コンプライアンス対応

**シナリオ**: 規制要件でイメージの出所証明が必要

**効果**: マネージド署名で監査可能な証跡を提供

### ユースケース 3: マルチチーム開発

**シナリオ**: 複数チームが共有するイメージの信頼性を確保

**効果**: 署名検証ポリシーで承認されたイメージのみを使用


## 料金

ECR の標準料金に加えて、KMS キーの使用料金が発生します。署名機能自体に追加料金はありません。


## 利用可能リージョン

Amazon ECR が利用可能なすべてのリージョンで利用可能です。


## 関連サービス・機能

- **Amazon ECR**: コンテナレジストリ
- **AWS KMS**: 鍵管理サービス
- **Amazon EKS**: Kubernetes サービス


## 参考リンク

- [公式発表](https://aws.amazon.com/about-aws/whats-new/2025/11/amazon-ecr-managed-container-image-signing/)
- [ECR ドキュメント](https://docs.aws.amazon.com/ecr/)


## まとめ

Amazon ECR のマネージドコンテナイメージ署名により、コンテナサプライチェーンのセキュリティが大幅に強化されました。自動署名と検証により、信頼できるイメージのみをデプロイできます。
