# AWS Lambda - SQS イベントソースマッピングのプロビジョンドモード

**リリース日**: 2025 年 11 月 17 日  
**サービス**: AWS Lambda  
**機能**: SQS イベントソースマッピングのプロビジョンドモード


## 概要

AWS Lambda は、SQS イベントソースマッピングのプロビジョンドモードを発表しました。この機能により、イベントポーリングリソースをプロビジョニングすることで、スループットを最適化し、トラフィックスパイクを処理できるようになります。

高スループットが求められるワークロードや、予測可能なパフォーマンスが必要なアプリケーションに最適です。

**アップデート前の課題**

- 以前は SQS イベントソースマッピングのポーリングリソースが自動的にスケールされるため、トラフィックスパイク時に遅延が発生する可能性があった
- 以前は高スループットが求められるワークロードで予測可能なパフォーマンスを確保することが困難だった
- 以前はポーリング遅延を削減するための細かな制御ができなかった

**アップデート後の改善**

- 今回のアップデートにより、イベントポーリングリソースを事前にプロビジョニングし、トラフィックスパイクに迅速に対応できるようになった
- 今回のアップデートにより、一貫したスループットと予測可能なパフォーマンスを確保できるようになった
- 今回のアップデートにより、最小・最大ポーラー数を設定してワークロードに応じた最適化が可能になった


## サービスアップデートの詳細

### 主要機能

1. **プロビジョンドポーリング**
   - イベントポーリングリソースの事前プロビジョニング
   - 一貫したスループットの確保
   - トラフィックスパイクへの迅速な対応

2. **スループット最適化**
   - 高スループット処理の実現
   - ポーリング遅延の削減
   - 予測可能なパフォーマンス

3. **柔軟なスケーリング**
   - 需要に応じたリソース調整
   - コスト効率の最適化
   - 自動スケーリングとの併用


## 技術仕様

### プロビジョンドモードの設定

| 項目 | 詳細 |
|------|------|
| 最小プロビジョニング | 1 |
| 最大プロビジョニング | 設定可能 |
| スケーリング | 自動/手動 |
| 対応キュータイプ | 標準キュー、FIFO キュー |

### 設定例

```json
{
  "EventSourceArn": "arn:aws:sqs:us-east-1:123456789012:my-queue",
  "FunctionName": "my-function",
  "BatchSize": 10,
  "ScalingConfig": {
    "MaximumConcurrency": 100
  },
  "ProvisionedPollerConfig": {
    "MinimumPollers": 5,
    "MaximumPollers": 20
  }
}
```

この設定例は、SQS イベントソースマッピングのプロビジョンドモードを構成しています。`ProvisionedPollerConfig` で最小 5 個、最大 20 個のポーラーをプロビジョニングし、一貫したスループットを確保します。`BatchSize` は一度に処理するメッセージ数、`MaximumConcurrency` は同時実行数の上限を指定します。


## 設定方法

### 前提条件

1. Lambda 関数が作成済み
2. SQS キューが作成済み
3. 適切な IAM 権限

### 手順

#### ステップ 1: イベントソースマッピングの作成

```bash
aws lambda create-event-source-mapping \
  --function-name my-function \
  --event-source-arn arn:aws:sqs:us-east-1:123456789012:my-queue \
  --batch-size 10 \
  --provisioned-poller-config MinimumPollers=5,MaximumPollers=20
```

#### ステップ 2: 設定の確認

```bash
aws lambda get-event-source-mapping \
  --uuid xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

このコマンドは、作成したイベントソースマッピングの設定を確認します。プロビジョンドポーラーの設定やバッチサイズなどの詳細を確認できます。


## メリット

### ビジネス面

- **信頼性向上**: 一貫したメッセージ処理
- **SLA 達成**: 予測可能なパフォーマンス
- **スケーラビリティ**: トラフィックスパイクへの対応

### 技術面

- **低レイテンシー**: ポーリング遅延の削減
- **高スループット**: 大量メッセージの効率的な処理
- **柔軟な設定**: ワークロードに応じた調整


## デメリット・制約事項

### 制限事項

- プロビジョンドリソースには追加コストが発生
- 最小プロビジョニング数の設定が必要

### 考慮すべき点

- ワークロードパターンの分析
- コストとパフォーマンスのバランス


## ユースケース

### ユースケース 1: 高スループットメッセージ処理

**シナリオ**: 大量のメッセージを低レイテンシーで処理したい

**効果**: プロビジョンドモードで一貫した高スループットを実現

### ユースケース 2: トラフィックスパイク対応

**シナリオ**: 予測不可能なトラフィックスパイクに対応したい

**効果**: 事前プロビジョニングにより迅速にスケールアウト

### ユースケース 3: SLA 要件の達成

**シナリオ**: メッセージ処理の SLA を満たす必要がある

**効果**: 予測可能なパフォーマンスで SLA を達成


## 料金

プロビジョンドポーラーには追加料金が発生します。詳細は AWS Lambda 料金ページを参照してください。


## 利用可能リージョン

AWS Lambda が利用可能なすべてのリージョンで利用可能です。


## 関連サービス・機能

- **AWS Lambda**: サーバーレスコンピューティング
- **Amazon SQS**: メッセージキューサービス
- **AWS Lambda Provisioned Concurrency**: 関数の事前ウォームアップ


## 参考リンク

- [公式発表](https://aws.amazon.com/about-aws/whats-new/2025/11/aws-lambda-provisioned-mode-sqs-esm/)
- [Lambda SQS 統合ドキュメント](https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html)


## まとめ

AWS Lambda の SQS イベントソースマッピングのプロビジョンドモードにより、高スループットで予測可能なメッセージ処理が可能になりました。トラフィックスパイクへの対応や SLA 要件の達成が求められるワークロードに最適です。
