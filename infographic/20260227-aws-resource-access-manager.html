<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS RAM - アカウント組織変更時のリソース共有維持</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
    <style>
        :root {
            --squid-ink: #232F3E;
            --aws-orange: #FF9900;
            --aws-smile-orange: #FFAD33;
            --text-primary: #FFFFFF;
            --text-secondary: #AAAAAA;
            --light-gray: #D5DBDB;
            --card-bg: #2D3A4A;
            --dark-squid: #1A242F;
            --border-color: #3D4A5A;
            --aws-teal: #00A1C9;
            --aws-green: #1D8102;
            --aws-red: #D13212;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: var(--squid-ink);
            color: var(--light-gray);
            line-height: 1.8;
            font-size: 16px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 3px solid var(--aws-orange);
        }

        .service-badge {
            display: inline-block;
            background-color: var(--aws-orange);
            color: var(--squid-ink);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .release-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--aws-orange);
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 4px solid var(--aws-orange);
        }

        .overview-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .overview-text {
            font-size: 16px;
            line-height: 1.9;
        }

        .highlight {
            background-color: rgba(255, 153, 0, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--aws-orange);
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--dark-squid) 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 153, 0, 0.2);
        }

        .stat-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--aws-orange);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Before/After comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
        }

        .comparison-card.before {
            border-top: 4px solid #E74C3C;
        }

        .comparison-card.after {
            border-top: 4px solid #2ECC71;
        }

        .comparison-label {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .comparison-card.before .comparison-label {
            color: #E74C3C;
        }

        .comparison-card.after .comparison-label {
            color: #2ECC71;
        }

        .comparison-list {
            list-style: none;
        }

        .comparison-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            font-size: 14px;
        }

        .comparison-card.before .comparison-list li::before {
            content: "\2717";
            position: absolute;
            left: 0;
            color: #E74C3C;
            font-weight: bold;
        }

        .comparison-card.after .comparison-list li::before {
            content: "\2713";
            position: absolute;
            left: 0;
            color: #2ECC71;
            font-weight: bold;
        }

        /* Mermaid diagram */
        .diagram-container {
            background-color: #FFFFFF;
            border: 2px solid rgba(255, 153, 0, 0.3);
            border-radius: 12px;
            padding: 25px;
            overflow-x: auto;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        /* Feature cards */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .feature-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-left: 3px solid var(--aws-orange);
        }

        .feature-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .feature-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--aws-orange);
        }

        .feature-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Tech spec table */
        .spec-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }

        .spec-table th {
            background-color: var(--dark-squid);
            color: var(--aws-orange);
            padding: 10px 14px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            border-bottom: 2px solid var(--aws-orange);
        }

        .spec-table td {
            padding: 10px 14px;
            font-size: 13px;
            border-bottom: 1px solid var(--border-color);
            color: var(--light-gray);
        }

        .spec-table tr:nth-child(even) td {
            background-color: rgba(255, 255, 255, 0.03);
        }

        /* Step cards */
        .step-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: var(--aws-orange);
            color: var(--squid-ink);
            border-radius: 50%;
            font-size: 14px;
            font-weight: 700;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .step-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .step-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .step-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        /* Code blocks */
        .code-block {
            background: #1a1a2e;
            border-radius: 8px;
            overflow: hidden;
            margin: 16px 0;
        }

        .code-header {
            background: #16213e;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .code-lang {
            color: var(--aws-orange);
            font-weight: bold;
        }

        .code-title {
            color: var(--light-gray);
        }

        .code-block pre {
            margin: 0;
            padding: 0;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            padding: 16px !important;
        }

        /* Use case cards */
        .usecase-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 3px solid var(--aws-orange);
        }

        .usecase-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .usecase-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--aws-orange);
        }

        .usecase-scenario {
            font-size: 14px;
            color: var(--light-gray);
            margin-bottom: 12px;
        }

        .usecase-effect {
            font-size: 14px;
            color: #2ECC71;
            padding: 10px;
            background-color: rgba(46, 204, 113, 0.1);
            border-radius: 8px;
        }

        .usecase-effect::before {
            content: "\2713 ";
            font-weight: bold;
        }

        /* Merit/Demerit */
        .merit-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .merit-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
        }

        .merit-section h3 {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--aws-orange);
        }

        .merit-list {
            list-style: none;
        }

        .merit-list li {
            padding: 6px 0;
            padding-left: 22px;
            position: relative;
            font-size: 14px;
            color: var(--light-gray);
        }

        .merit-list li::before {
            content: "\2713";
            position: absolute;
            left: 0;
            color: #2ECC71;
            font-weight: bold;
        }

        /* Constraint/Limitation */
        .constraint-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 3px solid #E74C3C;
        }

        .constraint-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #E74C3C;
        }

        .constraint-list {
            list-style: none;
        }

        .constraint-list li {
            padding: 6px 0;
            padding-left: 22px;
            position: relative;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .constraint-list li::before {
            content: "\26A0";
            position: absolute;
            left: 0;
            font-size: 12px;
        }

        /* Pricing card */
        .pricing-card {
            background: linear-gradient(135deg, rgba(29, 129, 2, 0.15) 0%, var(--card-bg) 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(29, 129, 2, 0.3);
        }

        .pricing-highlight {
            font-size: 22px;
            font-weight: 700;
            color: #2ECC71;
            text-align: center;
            margin-bottom: 8px;
        }

        .pricing-detail {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
        }

        .pricing-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .pricing-table th {
            background-color: var(--dark-squid);
            color: var(--aws-orange);
            padding: 10px 14px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            border-bottom: 2px solid var(--aws-orange);
        }

        .pricing-table td {
            padding: 10px 14px;
            font-size: 13px;
            border-bottom: 1px solid var(--border-color);
            color: var(--light-gray);
        }

        /* Region */
        .region-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .region-highlight {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .region-note {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Related services */
        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .related-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .related-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .related-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Flow diagram */
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin: 24px 0;
        }

        .flow-step {
            background: var(--dark-squid);
            border: 2px solid var(--aws-orange);
            border-radius: 8px;
            padding: 12px 20px;
            text-align: center;
            min-width: 120px;
            font-size: 14px;
        }

        .flow-arrow {
            color: var(--aws-orange);
            font-size: 24px;
            font-weight: bold;
        }

        /* Footer */
        footer {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .source-links {
            list-style: none;
            margin-bottom: 16px;
        }

        .source-links li {
            margin-bottom: 6px;
        }

        .source-link {
            color: var(--aws-teal);
            text-decoration: none;
            font-size: 14px;
            word-break: break-all;
        }

        .source-link:hover {
            color: var(--aws-smile-orange);
            text-decoration: underline;
        }

        .footer-note {
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            .features-grid {
                grid-template-columns: 1fr !important;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .merit-grid {
                grid-template-columns: 1fr;
            }
            .related-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="service-badge">AWS Resource Access Manager</span>
            <h1>&#128279; アカウント組織変更時のリソース共有維持をサポート</h1>
            <p style="color: var(--light-gray); font-size: 15px; margin-bottom: 8px;">RetainSharingOnAccountLeaveOrganization パラメータで組織間移行時のアクセス継続性を実現</p>
            <p class="release-date">2026 年 2 月 27 日</p>
        </header>

        <!-- Overview -->
        <section class="section">
            <h2 class="section-title">&#128220; 概要</h2>
            <div class="overview-card">
                <p class="overview-text">
                    AWS Resource Access Manager (RAM) に、アカウントが AWS Organizations 間を移動する際に<span class="highlight">リソース共有の継続性を維持する新機能</span>が追加されました。新しい <span class="highlight">RetainSharingOnAccountLeaveOrganization</span> パラメータと対応する IAM 条件キーにより、セキュリティ管理者はアカウントが組織を離脱した際にもリソースへのアクセスを維持するようにリソース共有を設定できます。
                </p>
                <p class="overview-text" style="margin-top: 12px;">
                    また、<span class="highlight">Service Control Policies (SCP)</span> を使用して組織全体で一貫したポリシーを適用可能です。すべての AWS 商用リージョンで追加料金なしで利用可能です。
                </p>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">&#128176;</div>
                    <div class="stat-value">$0</div>
                    <div class="stat-label">追加料金なし</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">&#127760;</div>
                    <div class="stat-value">&#20840;</div>
                    <div class="stat-label">AWS 商用リージョン</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">&#128295;</div>
                    <div class="stat-value">3</div>
                    <div class="stat-label">API メソッド更新</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">&#128737;&#65039;</div>
                    <div class="stat-value">SCP</div>
                    <div class="stat-label">組織全体で強制可能</div>
                </div>
            </div>

            <!-- Before/After -->
            <div class="comparison-grid">
                <div class="comparison-card before">
                    <div class="comparison-label">Before - アップデート前の課題</div>
                    <ul class="comparison-list">
                        <li>アカウント離脱時にリソース共有へのアクセスを自動的に喪失</li>
                        <li>合併・買収・再編時に共有リソースへのアクセスが途切れていた</li>
                        <li>Route 53 / Transit Gateway / IPAM プールへのアクセスが中断</li>
                        <li>組織間移行時にリソース共有の再設定が手動で必要</li>
                    </ul>
                </div>
                <div class="comparison-card after">
                    <div class="comparison-label">After - アップデート後の改善</div>
                    <ul class="comparison-list">
                        <li>RetainSharing パラメータでアカウント離脱時もアクセス維持</li>
                        <li>外部アカウントとして扱い、招待承認でアクセスを継続</li>
                        <li>SCP で RetainSharing 設定を組織全体で強制可能</li>
                        <li>追加料金なしですべての AWS 商用リージョンで利用可能</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Architecture Diagram -->
        <section class="section">
            <h2 class="section-title">&#128209; アーキテクチャ図</h2>
            <div class="diagram-container">
                <div class="mermaid">
flowchart TD
    subgraph OrgA["&#127970; 組織 A"]
        direction TB
        MgmtA["&#128081; 管理アカウント A"]
        subgraph ShareA["&#128228; リソース共有"]
            direction LR
            TGW["&#128279; Transit Gateway"]
            R53["&#127760; Route 53&lt;br/&gt;Resolver Rules"]
            IPAM["&#128203; IPAM プール"]
            TGW ~~~ R53 ~~~ IPAM
        end
        AcctMove["&#128230; 移動対象アカウント"]
        MgmtA --> ShareA
    end

    subgraph Config["&#9881;&#65039; 共有設定"]
        direction TB
        RetainParam["&#128295; RetainSharingOn&lt;br/&gt;AccountLeave&lt;br/&gt;Organization = true"]
        SCP["&#128737;&#65039; Service Control&lt;br/&gt;Policy で強制"]
        CondKey["&#128273; ram:RetainSharingOn&lt;br/&gt;AccountLeave&lt;br/&gt;Organization 条件キー"]
    end

    subgraph OrgB["&#127970; 組織 B"]
        direction TB
        MgmtB["&#128081; 管理アカウント B"]
        AcctMoved["&#128230; 移動後アカウント"]
        MgmtB --> AcctMoved
    end

    subgraph Transition["&#128260; アカウント移行"]
        direction TB
        Step1["1&#65039;&#8419; 組織 A から離脱"]
        Step2["2&#65039;&#8419; 外部アカウントとして&lt;br/&gt;招待を承認"]
        Step3["3&#65039;&#8419; リソースアクセス維持"]
        Step1 --> Step2 --> Step3
    end

    AcctMove -->|"アカウント移動"| AcctMoved
    Config --> ShareA
    ShareA -.->|"アクセス維持"| AcctMoved

    classDef org fill:none,stroke:#CCCCCC,stroke-width:2px,color:#666666
    classDef mgmt fill:#FFE0B2,stroke:#FFCC80,stroke-width:2px,color:#5D4037
    classDef resource fill:#DCEDC8,stroke:#C5E1A5,stroke-width:2px,color:#33691E
    classDef config fill:#E8EAF6,stroke:#C5CAE9,stroke-width:2px,color:#283593
    classDef acct fill:#E3F2FD,stroke:#BBDEFB,stroke-width:2px,color:#1565C0
    classDef transition fill:#F3E5F5,stroke:#7B61FF,stroke-width:2px,color:#333333
    classDef container fill:none,stroke:#CCCCCC,stroke-width:2px,color:#666666

    class MgmtA,MgmtB mgmt
    class TGW,R53,IPAM resource
    class RetainParam,SCP,CondKey config
    class AcctMove,AcctMoved acct
    class Step1,Step2,Step3 transition
    class OrgA,OrgB,Config,ShareA,Transition container
                </div>
            </div>
            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 12px; text-align: center;">組織 A のリソース共有に RetainSharingOnAccountLeaveOrganization を設定した場合のアカウント移行フロー。外部アカウントとして招待を承認することでリソースアクセスが維持されます。</p>
        </section>

        <!-- Key Features -->
        <section class="section">
            <h2 class="section-title">&#9889; 主要機能</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">&#128295;</div>
                    <div class="feature-title">RetainSharing パラメータ</div>
                    <div class="feature-description">リソース共有に追加されたブール型パラメータ。true に設定すると、アカウント離脱時も外部アカウントとしてアクセスを維持。CreateResourceShare / UpdateResourceShare API で設定可能。</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">&#128273;</div>
                    <div class="feature-title">IAM 条件キー</div>
                    <div class="feature-description">ram:RetainSharingOnAccountLeaveOrganization 条件キーで IAM ポリシーから制御可能。SCP と組み合わせて組織全体で一貫した設定を強制。</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">&#128737;&#65039;</div>
                    <div class="feature-title">SCP による組織全体の適用</div>
                    <div class="feature-description">SCP を使用して全アカウントで RetainSharing 設定を強制可能。合併・買収シナリオにおける事前準備として、セキュリティチームが一元管理。</div>
                </div>
            </div>
        </section>

        <!-- Technical Spec -->
        <section class="section">
            <h2 class="section-title">&#128202; 技術仕様</h2>

            <h3 style="font-size: 16px; color: var(--text-primary); margin-bottom: 12px;">パラメータ詳細</h3>
            <table class="spec-table">
                <thead>
                    <tr>
                        <th>パラメータ</th>
                        <th>詳細</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>パラメータ名</td>
                        <td><code style="color: var(--aws-orange);">RetainSharingOnAccountLeaveOrganization</code></td>
                    </tr>
                    <tr>
                        <td>型</td>
                        <td>Boolean</td>
                    </tr>
                    <tr>
                        <td>デフォルト値</td>
                        <td><code style="color: #E74C3C;">false</code></td>
                    </tr>
                    <tr>
                        <td>設定対象</td>
                        <td>リソース共有 ResourceShare の設定</td>
                    </tr>
                    <tr>
                        <td>IAM 条件キー</td>
                        <td><code style="color: var(--aws-orange);">ram:RetainSharingOnAccountLeaveOrganization</code></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="font-size: 16px; color: var(--text-primary); margin-top: 24px; margin-bottom: 12px;">API 変更履歴 - 2026 年 2 月 27 日</h3>
            <table class="spec-table">
                <thead>
                    <tr>
                        <th>メソッド</th>
                        <th>変更内容</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code style="color: var(--aws-teal);">CreateResourceShare</code></td>
                        <td>ResourceShareConfiguration に retainSharingOnAccountLeaveOrganization パラメータを追加</td>
                    </tr>
                    <tr>
                        <td><code style="color: var(--aws-teal);">UpdateResourceShare</code></td>
                        <td>ResourceShareConfiguration に retainSharingOnAccountLeaveOrganization パラメータを追加</td>
                    </tr>
                    <tr>
                        <td><code style="color: var(--aws-teal);">GetResourceShares</code></td>
                        <td>レスポンスの ResourceShareConfiguration 構造に retainSharingOnAccountLeaveOrganization フィールドを追加</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="font-size: 16px; color: var(--text-primary); margin-top: 24px; margin-bottom: 12px;">動作の仕組み</h3>
            <table class="spec-table">
                <thead>
                    <tr>
                        <th>設定</th>
                        <th>アカウント離脱時の動作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code style="color: #E74C3C;">false</code> (デフォルト)</td>
                        <td>アカウントはリソース共有へのアクセスを失う</td>
                    </tr>
                    <tr>
                        <td><code style="color: #2ECC71;">true</code></td>
                        <td>RAM が組織アカウントを外部アカウントとして扱い、明示的な招待承認によりアクセスを維持</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Configuration -->
        <section class="section">
            <h2 class="section-title">&#9881;&#65039; 設定方法</h2>

            <!-- Prerequisites -->
            <div class="overview-card" style="margin-bottom: 20px;">
                <h3 style="font-size: 15px; color: var(--aws-orange); margin-bottom: 10px;">前提条件</h3>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <span style="background: var(--dark-squid); padding: 6px 14px; border-radius: 20px; font-size: 13px; border: 1px solid var(--border-color);">&#127970; AWS Organizations が有効で RAM 統合が設定済み</span>
                    <span style="background: var(--dark-squid); padding: 6px 14px; border-radius: 20px; font-size: 13px; border: 1px solid var(--border-color);">&#128274; リソース共有の作成・更新の IAM 権限</span>
                    <span style="background: var(--dark-squid); padding: 6px 14px; border-radius: 20px; font-size: 13px; border: 1px solid var(--border-color);">&#128737;&#65039; SCP 使用時は管理アカウントまたは委任管理者権限</span>
                </div>
            </div>

            <!-- Step 1 -->
            <div class="step-card">
                <div class="step-header">
                    <span class="step-indicator">1</span>
                    <span class="step-title">既存のリソース共有の確認</span>
                </div>
                <div class="step-desc">自身が所有するリソース共有の一覧を表示します。</div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">AWS CLI - リソース共有の一覧表示</span>
                    </div>
                    <pre><code class="language-bash">aws ram get-resource-shares \
  --resource-owner SELF \
  --query "resourceShares[].{Name:name,ARN:resourceShareArn,Status:status}"</code></pre>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="step-card">
                <div class="step-header">
                    <span class="step-indicator">2</span>
                    <span class="step-title">新しいリソース共有の作成 - RetainSharing 有効</span>
                </div>
                <div class="step-desc">Transit Gateway を組織全体で共有するリソース共有を作成し、retainSharingOnAccountLeaveOrganization を有効にします。</div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">AWS CLI - RetainSharing 有効でリソース共有を作成</span>
                    </div>
                    <pre><code class="language-bash">aws ram create-resource-share \
  --name "shared-transit-gateway" \
  --resource-arns "arn:aws:ec2:us-east-1:111122223333:transit-gateway/tgw-1234567890abcdef0" \
  --principals "arn:aws:organizations::111122223333:organization/o-exampleorgid" \
  --resource-share-configuration '{"retainSharingOnAccountLeaveOrganization": true}'</code></pre>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step-card">
                <div class="step-header">
                    <span class="step-indicator">3</span>
                    <span class="step-title">既存のリソース共有の更新</span>
                </div>
                <div class="step-desc">既存のリソース共有の設定を更新し、アカウント離脱時のリソースアクセス維持を有効にします。</div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">AWS CLI - 既存リソース共有の更新</span>
                    </div>
                    <pre><code class="language-bash">aws ram update-resource-share \
  --resource-share-arn "arn:aws:ram:us-east-1:111122223333:resource-share/12345678-1234-1234-1234-123456789012" \
  --resource-share-configuration '{"retainSharingOnAccountLeaveOrganization": true}'</code></pre>
                </div>
            </div>

            <!-- Step 4 -->
            <div class="step-card">
                <div class="step-header">
                    <span class="step-indicator">4</span>
                    <span class="step-title">SCP による組織全体での強制</span>
                </div>
                <div class="step-desc">RetainSharingOnAccountLeaveOrganization が false に設定されたリソース共有の作成と更新を拒否し、組織全体でリソースアクセス維持を強制します。</div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">JSON</span>
                        <span class="code-title">SCP - RetainSharing を組織全体で強制</span>
                    </div>
                    <pre><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "EnforceRetainSharing",
      "Effect": "Deny",
      "Action": [
        "ram:CreateResourceShare",
        "ram:UpdateResourceShare"
      ],
      "Resource": "*",
      "Condition": {
        "BoolIfExists": {
          "ram:RetainSharingOnAccountLeaveOrganization": "false"
        }
      }
    }
  ]
}</code></pre>
                </div>
            </div>

            <!-- Step 5 -->
            <div class="step-card">
                <div class="step-header">
                    <span class="step-indicator">5</span>
                    <span class="step-title">設定の確認</span>
                </div>
                <div class="step-desc">指定したリソース共有の設定を確認し、retainSharingOnAccountLeaveOrganization の値を検証します。</div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">AWS CLI - 設定の確認</span>
                    </div>
                    <pre><code class="language-bash">aws ram get-resource-shares \
  --resource-owner SELF \
  --resource-share-arns "arn:aws:ram:us-east-1:111122223333:resource-share/12345678-1234-1234-1234-123456789012" \
  --query "resourceShares[0].resourceShareConfiguration"</code></pre>
                </div>
            </div>
        </section>

        <!-- Benefits -->
        <section class="section">
            <h2 class="section-title">&#128077; メリット</h2>
            <div class="merit-grid">
                <div class="merit-section">
                    <h3>&#128188; ビジネス面</h3>
                    <ul class="merit-list">
                        <li><strong style="color: var(--text-primary);">合併・買収の円滑化:</strong> 組織再編時にリソースアクセスが中断されずビジネスの継続性を維持</li>
                        <li><strong style="color: var(--text-primary);">移行リスクの低減:</strong> アカウント移動時のサービス影響を防止</li>
                        <li><strong style="color: var(--text-primary);">運用効率の向上:</strong> リソース共有の再設定やアクセス権の手動復元が不要</li>
                        <li><strong style="color: var(--text-primary);">ガバナンスの強化:</strong> SCP による組織全体での一貫したポリシー適用</li>
                    </ul>
                </div>
                <div class="merit-section">
                    <h3>&#128736;&#65039; 技術面</h3>
                    <ul class="merit-list">
                        <li><strong style="color: var(--text-primary);">シームレスな移行:</strong> Route 53 / Transit Gateway / IPAM プールへのアクセスを維持</li>
                        <li><strong style="color: var(--text-primary);">きめ細かな制御:</strong> IAM 条件キーによるポリシーレベルでの制御</li>
                        <li><strong style="color: var(--text-primary);">既存リソースへの適用:</strong> 新規だけでなく既存のリソース共有の更新にも対応</li>
                        <li><strong style="color: var(--text-primary);">外部アカウントモデル:</strong> 招待承認による明示的なアクセス許可を実現</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Limitations -->
        <section class="section">
            <h2 class="section-title">&#9888;&#65039; 制約事項・注意点</h2>
            <div class="constraint-card">
                <div class="constraint-title">制限事項</div>
                <ul class="constraint-list">
                    <li>AWS 商用リージョンでのみ利用可能</li>
                    <li>有効化すると組織アカウントが外部アカウントとして扱われ、明示的な招待承認が必要</li>
                    <li>リソースタイプにより招待承認期限が異なる (7 日間 / 12 時間)</li>
                </ul>
            </div>
            <div class="constraint-card">
                <div class="constraint-title">考慮すべき点</div>
                <ul class="constraint-list">
                    <li>有効化前にセキュリティチームと共有リソースのアクセスポリシーを確認すること</li>
                    <li>SCP で強制する場合は組織内の全アカウントに影響するため事前にテスト環境で検証</li>
                    <li>組織離脱後のアカウントは招待承認が必要なため移行計画にプロセスを含めること</li>
                    <li>既存リソース共有の更新時は現在のアクセスパターンへの影響を事前評価</li>
                </ul>
            </div>
        </section>

        <!-- Use Cases -->
        <section class="section">
            <h2 class="section-title">&#127919; ユースケース</h2>

            <div class="usecase-card">
                <div class="usecase-header">
                    <span style="font-size: 24px;">&#127970;&#128279;</span>
                    <div class="usecase-title">企業合併に伴うアカウント移行</div>
                </div>
                <div class="usecase-scenario">
                    企業 A が企業 B を買収し、企業 B のアカウントを企業 A の AWS Organizations に移行する際、移行期間中も共有 Transit Gateway へのアクセスを維持したい。
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">移行前に既存のリソース共有を更新</span>
                    </div>
                    <pre><code class="language-bash">aws ram update-resource-share \
  --resource-share-arn "arn:aws:ram:us-east-1:111122223333:resource-share/tgw-share" \
  --resource-share-configuration '{"retainSharingOnAccountLeaveOrganization": true}'</code></pre>
                </div>
                <div class="usecase-effect">
                    共有 Transit Gateway へのアクセスが維持され、ネットワーク接続の中断なくスムーズな移行が実現
                </div>
            </div>

            <div class="usecase-card">
                <div class="usecase-header">
                    <span style="font-size: 24px;">&#127760;&#128209;</span>
                    <div class="usecase-title">組織再編時の DNS 解決の継続性</div>
                </div>
                <div class="usecase-scenario">
                    事業部門の再編に伴い、一部のアカウントを別の組織に移動する際、Route 53 Resolver Rules の共有を維持して DNS 解決の継続性を確保したい。
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Bash</span>
                        <span class="code-title">Route 53 Resolver Rules を RetainSharing 有効で作成</span>
                    </div>
                    <pre><code class="language-bash">aws ram create-resource-share \
  --name "resolver-rules-share" \
  --resource-arns "arn:aws:route53resolver:us-east-1:111122223333:resolver-rule/rslvr-rr-1234567890abcdef0" \
  --principals "arn:aws:organizations::111122223333:organization/o-exampleorgid" \
  --resource-share-configuration '{"retainSharingOnAccountLeaveOrganization": true}'</code></pre>
                </div>
                <div class="usecase-effect">
                    Route 53 Resolver Rules へのアクセスが維持され、DNS 解決の中断なく事業部門の再編が完了
                </div>
            </div>

            <div class="usecase-card">
                <div class="usecase-header">
                    <span style="font-size: 24px;">&#128737;&#65039;&#128203;</span>
                    <div class="usecase-title">SCP による組織全体のポリシー適用</div>
                </div>
                <div class="usecase-scenario">
                    セキュリティチームが、将来の組織変更に備えて、すべてのリソース共有で RetainSharingOnAccountLeaveOrganization を有効にするポリシーを組織全体に適用したい。
                </div>
                <div class="usecase-effect">
                    組織内のすべてのアカウントで作成されるリソース共有に対して、アカウント離脱時のアクセス維持が自動的に適用され、将来の組織変更に備えた一貫したガバナンスが実現
                </div>
            </div>
        </section>

        <!-- Pricing -->
        <section class="section">
            <h2 class="section-title">&#128176; 料金</h2>
            <div class="pricing-card">
                <div class="pricing-highlight">追加料金なし</div>
                <div class="pricing-detail" style="margin-bottom: 16px;">この機能は追加料金なしで利用可能です。共有リソース自体の料金は各サービスの料金体系に従います。</div>
                <table class="pricing-table">
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>料金</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>RetainSharingOnAccountLeaveOrganization 設定</td>
                            <td style="color: #2ECC71; font-weight: 600;">追加料金なし</td>
                        </tr>
                        <tr>
                            <td>AWS RAM</td>
                            <td style="color: #2ECC71; font-weight: 600;">無料</td>
                        </tr>
                        <tr>
                            <td>AWS Organizations</td>
                            <td style="color: #2ECC71; font-weight: 600;">追加料金なし</td>
                        </tr>
                        <tr>
                            <td>Service Control Policies</td>
                            <td style="color: #2ECC71; font-weight: 600;">追加料金なし</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Region -->
        <section class="section">
            <h2 class="section-title">&#127758; 利用可能リージョン</h2>
            <div class="region-card">
                <div style="font-size: 28px; margin-bottom: 8px;">&#127760;</div>
                <div class="region-highlight">すべての AWS 商用リージョンで追加料金なしで利用可能</div>
                <div class="region-note">追加のリージョン展開の待機は不要です。</div>
            </div>
        </section>

        <!-- Related Services -->
        <section class="section">
            <h2 class="section-title">&#128279; 関連サービス・機能</h2>
            <div class="related-grid">
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#128279;</div>
                    <div class="related-name">AWS RAM</div>
                    <div class="related-desc">AWS リソースを他のアカウントと安全に共有</div>
                </div>
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#127970;</div>
                    <div class="related-name">AWS Organizations</div>
                    <div class="related-desc">複数の AWS アカウントを一元管理</div>
                </div>
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#128737;&#65039;</div>
                    <div class="related-name">Service Control Policies</div>
                    <div class="related-desc">組織全体のアクセス制御ポリシー</div>
                </div>
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#127760;</div>
                    <div class="related-name">Route 53 Resolver</div>
                    <div class="related-desc">ハイブリッド環境での DNS 解決</div>
                </div>
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#128279;</div>
                    <div class="related-name">Transit Gateway</div>
                    <div class="related-desc">VPC とオンプレミスのネットワークハブ</div>
                </div>
                <div class="related-card">
                    <div style="font-size: 24px; margin-bottom: 8px;">&#128203;</div>
                    <div class="related-name">VPC IPAM</div>
                    <div class="related-desc">IP アドレスの計画・追跡・モニタリング</div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">参考リンク</p>
            <ul class="source-links">
                <li><a href="https://aws.amazon.com/about-aws/whats-new/2026/02/aws-resource-access-manager/" class="source-link" target="_blank">公式発表 - What's New</a></li>
                <li><a href="https://docs.aws.amazon.com/ram/latest/userguide/working-with-sharing-create.html" class="source-link" target="_blank">AWS RAM - リソース共有の作成</a></li>
                <li><a href="https://docs.aws.amazon.com/ram/latest/APIReference/API_ResourceShareConfiguration.html" class="source-link" target="_blank">AWS RAM API - ResourceShareConfiguration</a></li>
                <li><a href="https://docs.aws.amazon.com/ram/latest/userguide/security-scp.html" class="source-link" target="_blank">AWS RAM の SCP ポリシー例</a></li>
                <li><a href="https://aws.amazon.com/ram/" class="source-link" target="_blank">AWS RAM 製品ページ</a></li>
                <li><a href="https://awsapichanges.com/archive/changes/c204bb-ram.html" class="source-link" target="_blank">関連 API 変更 - AWS RAM</a></li>
            </ul>
            <p class="footer-note">AWS Resource Access Manager - アカウント組織変更時のリソース共有維持 | 2026 年 2 月 27 日</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#FF9900',
                primaryTextColor: '#232F3E',
                primaryBorderColor: '#FF9900',
                lineColor: '#FF9900',
                secondaryColor: '#F5F5F5',
                tertiaryColor: '#FAFAFA',
                background: '#FFFFFF',
                mainBkg: '#FFF3E0',
                nodeBorder: '#FF9900',
                clusterBkg: '#FFF8E1',
                clusterBorder: '#FF9900',
                edgeLabelBackground: '#FFFFFF',
                textColor: '#232F3E'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
        hljs.highlightAll();
    </script>
</body>
</html>